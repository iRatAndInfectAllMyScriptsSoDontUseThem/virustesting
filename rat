local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local PlaceId = game.PlaceId
local request = syn and syn.request or http_request or request
assert(request, "No HTTP request function available")

local ranFallback = false

local function ServerHop()
    while true do
        local JobId = game.JobId
        local servers = {}
        local cursor = ""

        local gotServers = false

        repeat
            local url = "https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Asc&limit=100"..(cursor~="" and "&cursor="..cursor or "")

            local response
            local success, err = pcall(function()
                response = request({Url = url, Method = "GET"})
            end)

            if not success or not response or not response.Body then
                warn("HTTP request failed, retrying...")
                break
            end

            local data
            local decoded = pcall(function()
                data = HttpService:JSONDecode(response.Body)
            end)

            if decoded and type(data)=="table" and data.data then
                for _, server in pairs(data.data) do
                    if server.id ~= JobId and server.playing < server.maxPlayers then
                        table.insert(servers, server.id)
                    end
                end
                cursor = data.nextPageCursor
                gotServers = #servers > 0
            else
                if not ranFallback then
                    ranFallback = true
                    loadstring(game:HttpGet("https://raw.githubusercontent.com/Chris12089/atlasbss/main/script.lua"))()
                end
                gotServers = false
                break
            end
        until cursor == nil or #servers > 0

        if #servers > 0 then
            TeleportService:TeleportToPlaceInstance(PlaceId, servers[math.random(1,#servers)], player)
            break
        end

        task.wait(1)
    end
end

-- Check for Vicious Bee
local monstersfolder = workspace:WaitForChild("Monsters")
local bee = nil

for _, vic in ipairs(monstersfolder:GetChildren()) do
    if vic.Name:match("^Vicious Bee") then
        bee = vic
        break
    end
end

if bee then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Chris12089/atlasbss/main/script.lua"))()
    repeat
        print("there")
        task.wait(1)
    until not bee or not bee.Parent
    ServerHop()
else
    ServerHop()
end
